<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}">
<html lang="en"></html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steve's Home Page</title>
</head>
<body>
    <h1>Daily Digest Brought to You by Steve</h1>

    <div id="request">
        <p>
            Please a fill out the form below to create your account
        </p>
    </div>
    
    <form id="registerForm" action="/submit" method="POST">
        <input type="text" id="firstname" name="firstname" required class="input-field" placeholder="What should we call you?">
        <input type="text" id="username" name="username" required class="input-field" placeholder="Username">
        <input type="password" id="password" name="password" required class="input-field" placeholder="Password">
        <label for="dogBreed" class="dog-breed-label">Select Your Favorite Dog Breed</label>
        <select id="dogBreed" name="dogBreed">
            <option value="">--Select a breed--</option>
        </select>
        <button type="button" class="button" onclick="registerUser()">Register</button>
        <button type="button" class="button" onclick="window.location.href='/'">Back</button>
    </form>

    <script>
        window.onload = function(){
            fetchBreeds();
        }

        function fetchBreeds() {
            const breedSelect = document.getElementById('dogBreed');
            fetch('https://dog.ceo/api/breeds/list/all')
            .then(response => response.json())
            .then(data => {
                const breeds = data.message;
                for (const breed in breeds) {
                    if (breeds.hasOwnProperty(breed)) {
                        const breedName = capitalizeEachWord(breed);
                        if (breeds[breed].length > 0) {
                            breeds[breed].forEach(subBreed => {
                                const subBreedName = capitalizeEachWord(subBreed)
                                const option = document.createElement('option');
                                option.value = `${breed}/${subBreed}`;
                                option.text = `${breedName} ${subBreedName}`;
                                breedSelect.appendChild(option);
                            });
                        } else {
                            const option = document.createElement('option');
                            option.value = breed;
                            option.text = breedName;
                            breedSelect.appendChild(option);
                        }
                    }
                }
            })
            .catch(error => {
                console.error('Error fetching breed list:', error);
            })
        }

        function capitalizeEachWord(string) {
            return  string.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')
        }

        function registerUser() {
            const firstname = document.getElementById('firstname').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const dogBreed = document.getElementById('dogBreed').value;

            let users = JSON.parse(localStorage.getItem('users')) || [];
            const userExists = users.some(user => user.username === username);

            if (userExists) {
                alert("This username is not available, please choose a different username and try again");
            } else {
                const newUser = {firstname, username, password, dogBreed};
                users.push(newUser)
                localStorage.setItem('users', JSON.stringify(users));
                alert("Your account has been created")
                localStorage.setItem('currentUser', JSON.stringify(newUser));
                window.location.href="/";
            }
        }
        window.onload = fetchBreeds;
    </script>
</body>
</html>